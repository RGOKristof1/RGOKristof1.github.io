<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NFC JSON Admin - Vizualizált</title>
  <style>
    body { font-family: sans-serif; background: #121212; color: #eee; max-width: 600px; margin: auto; padding: 20px; }
    input[type="text"] { width: 100%; padding: 8px; margin-bottom: 5px; background: #1e1e1e; color: white; border: 1px solid #444; }
    button { padding: 8px; margin-top: 10px; background: #333; color: white; border: none; cursor: pointer; }
    button:hover { background: #555; }
    .tag-box { margin-bottom: 15px; background: #1e1e1e; padding: 10px; border-radius: 8px; position: relative; }
    .remove-btn { position: absolute; right: 10px; top: 10px; color: red; background: none; border: none; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

  <h2>Tag szerkesztés</h2>

  <label for="token">GitHub Token:</label>
  <input type="password" id="token" placeholder="Token" />

  <label for="gistId">Gist ID:</label>
  <input type="text" id="gistId" placeholder="Gist ID" />

  <button onclick="loadGist()">Betöltés</button>

  <div id="tagsContainer"></div>

  <h3>Új tag hozzáadása</h3>
  <input type="text" id="newTagName" placeholder="Új tag neve" />
  <button onclick="addNewTag()">Hozzáadás</button>

  <br><br>
  <button onclick="saveToGist()">Mentés Gist-be</button>

  <pre id="status"></pre>

  <script>
    let currentData = {};
    const container = document.getElementById('tagsContainer');

    function loadGist() {
      const token = document.getElementById('token').value;
      const gistId = document.getElementById('gistId').value;

      fetch(`https://api.github.com/gists/${gistId}`, {
        headers: { Authorization: `token ${token}` }
      })
      .then(res => res.json())
      .then(data => {
        const fileKey = Object.keys(data.files).find(key => key === 'data.json') || Object.keys(data.files)[0];
        currentData = JSON.parse(data.files[fileKey].content);
        renderTags();
      })
      .catch(err => {
        document.getElementById('status').textContent = "Hiba: " + err.message;
      });
    }

    function renderTags() {
      container.innerHTML = '';
      Object.keys(currentData).forEach(tag => {
        const box = document.createElement('div');
        box.className = 'tag-box';

        const input = document.createElement('input');
        input.type = 'text';
        input.value = currentData[tag].text || currentData[tag].link || '';
        input.placeholder = 'Szöveg vagy link...';
        input.oninput = () => {
          const val = input.value.trim();
          if (val.startsWith('http')) {
            currentData[tag] = { link: val };
          } else {
            currentData[tag] = { text: val };
          }
        };

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.innerText = 'X';
        removeBtn.onclick = () => {
          if (confirm(`Biztos törölni akarod a "${tag}" taget?`)) {
            delete currentData[tag];
            renderTags();
          }
        };

        box.appendChild(input);
        box.appendChild(removeBtn);
        container.appendChild(box);
      });
    }

    function addNewTag() {
      const name = document.getElementById('newTagName').value.trim();
      if (name && !currentData[name]) {
        currentData[name] = { text: "" };
        renderTags();
        document.getElementById('newTagName').value = '';
      } else {
        alert("Adj meg egy egyedi tag nevet!");
      }
    }

    function saveToGist() {
      const token = document.getElementById('token').value;
      const gistId = document.getElementById('gistId').value;

      const body = {
        files: {
          'data.json': { content: JSON.stringify(currentData, null, 2) }
        }
      };

      fetch(`https://api.github.com/gists/${gistId}`, {
        method: 'PATCH',
        headers: {
          Authorization: `token ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById('status').textContent = "Sikeresen elmentve!";
      })
      .catch(err => {
        document.getElementById('status').textContent = "Hiba mentés közben: " + err.message;
      });
    }
  </script>
</body>
</html>

