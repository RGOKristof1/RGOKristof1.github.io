<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NFC JSON Admin - GitHub Gist (Sötét mód)</title>
<style>
  body {
    font-family: monospace, monospace;
    max-width: 700px;
    margin: 2rem auto;
    padding: 1rem;
    background-color: #121212;
    color: #eee;
  }
  label {
    display: block;
    margin: 0.8rem 0 0.3rem 0;
    color: #bbb;
  }
  input, button, textarea {
    width: 100%;
    padding: 0.7rem;
    margin-bottom: 0.7rem;
    border-radius: 5px;
    border: 1px solid #444;
    background-color: #1e1e1e;
    color: #eee;
    font-size: 1rem;
  }
  input:focus, textarea:focus {
    outline: none;
    border-color: #5599ff;
    background-color: #292929;
  }
  button {
    cursor: pointer;
    background-color: #5599ff;
    border: none;
    font-weight: bold;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #3377ff;
  }
  #status {
    font-family: monospace;
    background-color: #222;
    border: 1px solid #444;
    color: #ccc;
    padding: 0.6rem;
    min-height: 1.4rem;
    user-select: none;
  }
  #login-section {
    transition: opacity 0.3s ease;
  }
  #login-section.hidden {
    opacity: 0;
    height: 0;
    overflow: hidden;
    margin: 0;
    padding: 0;
  }
  textarea {
    height: 400px;
    font-family: monospace;
    font-size: 14px;
    resize: vertical;
  }
</style>
</head>
<body>

  <h1>NFC JSON Admin</h1>

  <div id="login-section">
    <label for="token">GitHub Personal Access Token (gist-hez olvasási/írási jogok):</label>
    <input type="password" id="token" placeholder="GitHub Token" autocomplete="off" />

    <label for="gistId">Gist ID:</label>
    <input type="text" id="gistId" placeholder="Pl: 2c5d42fd93a81ec543fee7762100f308" autocomplete="off" />

    <button id="loadBtn">Gist Betöltése</button>
  </div>

  <textarea id="jsonContent" placeholder="JSON tartalom itt jelenik meg..." style="display:none;"></textarea>

  <button id="saveBtn" style="display:none;">Mentés Gist-be</button>

  <pre id="status"></pre>

<script>
  const tokenInput = document.getElementById('token');
  const gistIdInput = document.getElementById('gistId');
  const loadBtn = document.getElementById('loadBtn');
  const saveBtn = document.getElementById('saveBtn');
  const jsonContent = document.getElementById('jsonContent');
  const status = document.getElementById('status');
  const loginSection = document.getElementById('login-section');

  let currentGistData = null;

  function setStatus(msg) {
    status.textContent = msg;
  }

  loadBtn.addEventListener('click', () => {
    const token = tokenInput.value.trim();
    const gistId = gistIdInput.value.trim();

    if(!token || !gistId) {
      setStatus("Kérlek add meg a token-t és a gist ID-t!");
      return;
    }

    setStatus("Betöltés...");

    fetch(`https://api.github.com/gists/${gistId}`, {
      headers: { Authorization: `token ${token}` }
    })
    .then(res => {
      if (!res.ok) throw new Error(`Hiba a betöltéskor: ${res.status}`);
      return res.json();
    })
    .then(data => {
      let fileKey = Object.keys(data.files).find(key => key === 'data.json') || Object.keys(data.files)[0];
      currentGistData = data;

      jsonContent.value = data.files[fileKey].content;
      setStatus("Betöltve: " + fileKey);

      // Elrejtjük a login részt, megmutatjuk az editort
      loginSection.classList.add('hidden');
      jsonContent.style.display = 'block';
      saveBtn.style.display = 'block';
    })
    .catch(err => {
      setStatus("Hiba: " + err.message);
    });
  });

  saveBtn.addEventListener('click', () => {
    if(!currentGistData) {
      setStatus("Előbb töltsd be a gist-et!");
      return;
    }

    const token = tokenInput.value.trim();
    const gistId = gistIdInput.value.trim();
    const newContent = jsonContent.value.trim();

    try {
      JSON.parse(newContent);
    } catch(e) {
      setStatus("Hibás JSON: " + e.message);
      return;
    }

    let fileKey = Object.keys(currentGistData.files).find(key => key === 'data.json') || Object.keys(currentGistData.files)[0];

    const body = { files: {} };
    body.files[fileKey] = { content: newContent };

    setStatus("Mentés folyamatban...");

    fetch(`https://api.github.com/gists/${gistId}`, {
      method: 'PATCH',
      headers: {
        Authorization: `token ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body)
    })
    .then(res => {
      if (!res.ok) throw new Error(`Hiba a mentéskor: ${res.status}`);
      return res.json();
    })
    .then(data => {
      currentGistData = data;
      setStatus("Sikeres mentés!");
    })
    .catch(err => {
      setStatus("Hiba: " + err.message);
    });
  });
</script>

</body>
</html>
